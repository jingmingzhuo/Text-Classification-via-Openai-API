# Text Classification via Openai API

In this project, I implemented an exception-capable, optional threading, reusable and checkpoint re-testing Openai API calling pipeline for text classification with supporting "zero-shot", "few-shot ", "chain of thoughts", and "tree of thoughts" methods.

## Setup

- First you need to put Openai API key in the environment variable `OPENAI_API_KEY`.

- Install the required packages: `pip install openai backoff pandas`

- You also need to put the dataset in the right place:

  Download the MMLU dataset from [cais/mmlu · Datasets at Hugging Face](https://huggingface.co/datasets/cais/mmlu) , SST2 dataset from [sst2 · Datasets at Hugging Face](https://huggingface.co/datasets/sst2).

  And put them in the corresponding folder in the data folder

## Experiments

### Arguments

There are the arguments:

- `--model`: Choose to use gpt-3.5-turbo or gpt-4.
- `--temperature`: Set the temperature parameter of the model for the test.
- `--task_name`: Select task categories.
- `--task_file_path`: Dataset file path. 
- `--prompt`(choices=[`pure`, `few-shot`, `cot`, `tot`]) : Methods used in testing.
- `--thread`(choices=[`single`,`multi`]): Choose to use single or multi-threaded.
- `--thread_num`: When using multiple threads, the number of threads.
- `--save_path`: The path where the testsing log is saved.
- `--test_method`(choices=[`renew`,`continue`]): Continue testing or retesting.
- `--test_num`: Number of data points tested (when set to 0, all remaining data are tested).
- `--generate_num`: When using the tot method, number of thoughts generated by the thought generator at each step.

### Samples

MMLU test using ToT:

```shell
python main.py \
--task_name mmlu \
--task_file_path data\mmlu\world_religions_test.csv \
--prompt tot \
--test_method continue \
--test_num 10 \
--generate_num 5
```

SST2 test using few-shot:

```shell
python main.py \
--task_name sst2 \
--task_file_path data\sst2\train.tsv \
--prompt few-shot \
--thread multi \
--thread_num 5 \
--test_method continue \
--test_num 100
```

### Results

MMLU:

| Method   | Pure  | Chain of thought | Tree of thought |
| -------- | :---: | :--------------: | :-------------: |
| Accuracy | 0.825 |      0.848       |      0.850      |

SST2:

| Method   | Pure  | Few-shot |
| -------- | :---: | :------: |
| Accuracy | 0.845 |  0.740   |

## Acknowledgments

We have constructed this project by referring to the code style of [there](https://github.com/princeton-nlp/tree-of-thought-llm). In the mmlu task, the cot prompt comes from [there](https://github.com/FranxYao/chain-of-thought-hub). Sincere thanks to both of them.
